import socket

HOST = 'localhost'
PORT = 21
USER = 'anonymous'
PASS = 'foo@somewhere.com'

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((HOST, PORT))

# Check return code is 200 series
data = s.recv(1024)
if data[0:1] == '2':
	print 'Connected to server: ' + data
s.sendall('USER ' + USER + '\r\n')
#recv some stuff
print s.recv(512)
s.sendall('PASS ' + PASS + '\r\n')

#Check we're now logged in
data = s.recv(1024)
if data[0:1] == '2':
	print data

# Find the IP and port on which to establish a data connection
s.sendall('PASV\r\n')
data = s.recv(1024)
if data[0:1] != '2':
	print "Response when requesting passive mode was " + data
	exit(1)

list = data[data.index('(')+1:data.index(')')].split(',')
data_ip = list[0] + '.' + list[1] + '.' + list[2] + list[3]
data_port = 256 * int(list[4]) + int(list[5])

# Create a data connection!
s2 = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s2.connect((data_ip, data_port))

# Get a directory list:
s.sendall('LIST\r\n')

data = s2.recv(1024)
while len(data) > 0:
	print data
	data = s2.recv(1024)

